<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagramas de Flujo - Seguros Universales</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #ffffff;
            padding: 20px;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 10px;
            border: 3px solid #000000;
            margin-bottom: 30px;
            text-align: center;
        }

        .header h1 {
            color: #1F4E78;
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            color: #666;
            font-size: 1.2em;
        }

        .viz-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            border: 3px solid #000000;
            margin-bottom: 30px;
            display: none;
        }

        .viz-container.active {
            display: block;
        }

        .viz-title {
            color: #1F4E78;
            font-size: 1.8em;
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
        }

        .viz-description {
            color: #666;
            text-align: center;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        #sankeyCompleto {
            width: 100%;
            height: 850px;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .legend-color {
            width: 30px;
            height: 20px;
            border-radius: 4px;
            border: 1px solid #000;
        }

        .legend-label {
            font-weight: 600;
            color: #333;
        }

        .footer {
            text-align: center;
            color: #666;
            margin-top: 30px;
            padding: 20px;
            font-size: 0.9em;
        }

        .info-box {
            background: #f8f9fa;
            border-left: 4px solid #1F4E78;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .info-box h3 {
            color: #1F4E78;
            margin-bottom: 10px;
        }

        .info-box ul {
            margin-left: 20px;
            color: #666;
        }

        .info-box li {
            margin: 5px 0;
        }

        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Diagrama de Flujo de Distribuci√≥n de Cartera</h1>
            <p>Centro de Costo ‚Üí Sub Ramo ‚Üí Mercado | Producci√≥n Enero - Septiembre 2025</p>
        </div>

        <!-- Visualizaci√≥n: Sankey Completo -->
        <div id="viz-completo" class="viz-container active">
            <h2 class="viz-title">FLUJO COMPLETO: CENTRO DE COSTO ‚Üí SUB RAMO ‚Üí MERCADO</h2>
            <p class="viz-description">El grosor de las l√≠neas representa el volumen de producci√≥n. Cada color identifica un Sub Ramo espec√≠fico.</p>
            <div id="sankeyCompleto"></div>
            <div class="info-box">
                <h3>üí° C√≥mo interpretar:</h3>
                <ul>
                    <li>Las l√≠neas m√°s gruesas indican mayor producci√≥n</li>
                    <li><strong>Cada color representa un Sub Ramo diferente</strong> - sigue el color para ver el flujo completo de un producto</li>
                    <li>Puedes arrastrar los nodos para reorganizar la visualizaci√≥n</li>
                    <li>Pasa el mouse sobre las l√≠neas para ver el Sub Ramo y el monto exacto</li>
                </ul>
            </div>
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #e74c3c;"></div>
                    <span class="legend-label">VIDA</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #3498db;"></div>
                    <span class="legend-label">VEH√çCULOS AUTOMOTORES</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #2ecc71;"></div>
                    <span class="legend-label">SEGURO T√âCNICO</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #f39c12;"></div>
                    <span class="legend-label">ACCIDENTES</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #9b59b6;"></div>
                    <span class="legend-label">DESEMPLEO</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #1abc9c;"></div>
                    <span class="legend-label">PARAM√âTRICO</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #e67e22;"></div>
                    <span class="legend-label">INCENDIO</span>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>¬© 2025 Seguros Universales S.A. | Divisi√≥n de Canales Alternos | An√°lisis de Producci√≥n Enero-Septiembre</p>
        </div>
    </div>

    <script>
        // Paleta de colores para Sub Ramos
        const ramoColors = {
            'VIDA': '#e74c3c',
            'VEHICULOS AUTOMOTORES': '#3498db',
            'SEGURO TECNICO': '#2ecc71',
            'ACCIDENTES': '#f39c12',
            'DESEMPLEO': '#9b59b6',
            'PARAM√âTRICO': '#1abc9c',
            'INCENDIO Y LINEAS ALIADAS': '#e67e22',
            'AVIACION': '#34495e',
            'RESPONSABILIDAD CIVIL': '#16a085',
            'TRANSPORTE': '#d35400',
            'ROBO': '#c0392b',
            'DINERO Y/O VALORES': '#8e44ad',
            'SEGURO OBLIGATORIO': '#27ae60',
            'MARITIMOS': '#2980b9'
        };

        // Datos de producci√≥n por centro de costo (en millones)
        const produccionData = {
            'BAC': 44.82,
            'Banco Antigua': 31.79,
            'TIGO': 15.53,
            'Venta Directa': 13.00,
            'CrediQ': 8.62,
            'Otras cuentas': 7.17,
            'Distelsa': 5.74,
            'Guadalupana': 4.72,
            'Jarfesa': 3.72,
            'CrediChapin': 3.66,
            'Finca': 3.61,
            'Banco Inmobiliario': 1.80,
            'MINDEF': 1.60,
            'Sostengo': 1.22,
            'Cooitza': 1.02
        };

        // Participaci√≥n por centro de costo
        const participacionCentro = {
            'BAC': 30.28,
            'Banco Antigua': 21.48,
            'TIGO': 10.49,
            'Venta Directa': 8.78,
            'CrediQ': 5.82,
            'Otras cuentas': 4.84,
            'Distelsa': 3.88,
            'Guadalupana': 3.19,
            'Jarfesa': 2.51,
            'CrediChapin': 2.47,
            'Finca': 2.44,
            'MINDEF': 1.08,
            'Sostengo': 0.82,
            'Cooitza': 0.69,
            'Banco Inmobiliario': 1.22
        };

        // Participaci√≥n por mercado
        const participacionMercado = {
            'CONCESONARIO': 36.10,
            'BANCA': 22.69,
            'TELEFONIA': 10.49,
            'VENTA DIRECTA': 8.78,
            'FINANCIERA': 4.91,
            'OTROS CANALES': 4.84,
            'COPERATIVA': 3.88,
            'Tienda de retail': 3.88,
            'COMERCIALIZADOR': 2.51,
            'GOBIERNO': 1.08,
            'APPS/WEB': 0.82
        };

        // Conexiones Centro de Costo √ó Sub Ramo
        const conexiones = {
            'BAC': ['VEHICULOS AUTOMOTORES', 'ACCIDENTES', 'VIDA'],
            'Banco Antigua': ['INCENDIO Y LINEAS ALIADAS', 'VEHICULOS AUTOMOTORES', 'DESEMPLEO', 'PARAM√âTRICO', 'VIDA'],
            'Banco Inmobiliario': ['VIDA'],
            'Cooitza': ['VEHICULOS AUTOMOTORES', 'ACCIDENTES', 'VIDA'],
            'CrediChapin': ['VEHICULOS AUTOMOTORES', 'VIDA'],
            'CrediQ': ['VEHICULOS AUTOMOTORES', 'VIDA'],
            'Distelsa': ['VEHICULOS AUTOMOTORES', 'DESEMPLEO', 'VIDA'],
            'Finca': ['DESEMPLEO', 'PARAM√âTRICO', 'VIDA'],
            'Guadalupana': ['INCENDIO Y LINEAS ALIADAS', 'VEHICULOS AUTOMOTORES', 'ACCIDENTES', 'VIDA'],
            'Jarfesa': ['ACCIDENTES', 'VIDA'],
            'MINDEF': ['VEHICULOS AUTOMOTORES', 'VIDA'],
            'Otras cuentas': ['VEHICULOS AUTOMOTORES', 'ACCIDENTES', 'PARAM√âTRICO', 'VIDA'],
            'Sostengo': ['VEHICULOS AUTOMOTORES', 'VIDA'],
            'TIGO': ['SEGURO TECNICO', 'VIDA'],
            'Venta Directa': ['INCENDIO Y LINEAS ALIADAS', 'VEHICULOS AUTOMOTORES', 'TRANSPORTE', 'ACCIDENTES', 
                             'RESPONSABILIDAD CIVIL', 'AVIACION', 'SEGURO TECNICO', 'ROBO', 'DINERO Y/O VALORES', 
                             'MARITIMOS', 'SEGURO OBLIGATORIO', 'VIDA']
        };

        // Participaci√≥n por Sub Ramo
        const ramoParticipacion = {
            'VIDA': 40.96,
            'VEHICULOS AUTOMOTORES': 35.37,
            'SEGURO TECNICO': 10.56,
            'ACCIDENTES': 4.86,
            'DESEMPLEO': 4.51,
            'PARAM√âTRICO': 1.65,
            'INCENDIO Y LINEAS ALIADAS': 1.52,
            'AVIACION': 0.31,
            'RESPONSABILIDAD CIVIL': 0.21,
            'TRANSPORTE': 0.06,
            'ROBO': 0.03,
            'DINERO Y/O VALORES': 0.00,
            'SEGURO OBLIGATORIO': 0.00,
            'MARITIMOS': -0.03
        };

        // Datos de mercado √ó sub ramo
        const mercadoRamoData = {
            'VIDA': {'BANCA': 69.26, 'COMERCIALIZADOR': 91.25, 'CONCESONARIO': 26.23, 'COPERATIVA': 78.48, 
                     'FINANCIERA': 97.20, 'GOBIERNO': 100, 'OTROS CANALES': 87.66, 'Tienda de retail': 3.57, 'VENTA DIRECTA': 0.50},
            'VEHICULOS AUTOMOTORES': {'APPS/WEB': 100, 'CONCESONARIO': 73.77, 'COPERATIVA': 8.06, 'OTROS CANALES': 11.12, 
                                     'Tienda de retail': 93.52, 'VENTA DIRECTA': 41.60},
            'SEGURO TECNICO': {'TELEFONIA': 100, 'VENTA DIRECTA': 0.76},
            'ACCIDENTES': {'BANCA': 1.50, 'COMERCIALIZADOR': 8.75, 'COPERATIVA': 1.73, 'OTROS CANALES': 1.22, 'VENTA DIRECTA': 47.44},
            'DESEMPLEO': {'BANCA': 19.03, 'FINANCIERA': 0.25, 'Tienda de retail': 2.92},
            'PARAM√âTRICO': {'BANCA': 6.64, 'FINANCIERA': 2.55},
            'INCENDIO Y LINEAS ALIADAS': {'BANCA': 3.41, 'COPERATIVA': 11.73, 'VENTA DIRECTA': 3.15},
            'AVIACION': {'VENTA DIRECTA': 3.49},
            'RESPONSABILIDAD CIVIL': {'VENTA DIRECTA': 2.35},
            'TRANSPORTE': {'VENTA DIRECTA': 0.65},
            'ROBO': {'VENTA DIRECTA': 0.39},
            'DINERO Y/O VALORES': {'VENTA DIRECTA': 0.04},
            'SEGURO OBLIGATORIO': {'VENTA DIRECTA': 0.02}
        };

        // ========== VISUALIZACI√ìN 1: SANKEY COMPLETO ==========
        function createSankeyCompleto() {
            const nodes = [];
            const links = [];
            const nodeMap = {};
            let nodeIndex = 0;

            // Crear nodos para Centros de Costo
            Object.keys(produccionData).forEach(centro => {
                nodeMap[centro] = nodeIndex;
                nodes.push({name: centro, color: '#95a5a6'});
                nodeIndex++;
            });

            // Crear nodos para Sub Ramos
            const ramos = [...new Set(Object.values(conexiones).flat())];
            ramos.forEach(ramo => {
                nodeMap[ramo] = nodeIndex;
                nodes.push({name: ramo, color: ramoColors[ramo] || '#bdc3c7'});
                nodeIndex++;
            });

            // Crear nodos para Mercados
            const mercados = ['BANCA', 'COMERCIALIZADOR', 'CONCESONARIO', 'COPERATIVA', 'FINANCIERA', 
                            'GOBIERNO', 'OTROS CANALES', 'TELEFONIA', 'Tienda de retail', 'VENTA DIRECTA', 'APPS/WEB'];
            mercados.forEach(mercado => {
                nodeMap[mercado] = nodeIndex;
                nodes.push({name: mercado, color: '#7f8c8d'});
                nodeIndex++;
            });

            // Crear links Centro ‚Üí Ramo
            Object.entries(conexiones).forEach(([centro, ramos]) => {
                const produccionCentro = produccionData[centro];
                ramos.forEach(ramo => {
                    const participacionRamo = ramoParticipacion[ramo] || 1;
                    const valor = (produccionCentro * participacionRamo / 100) / ramos.length;
                    links.push({
                        source: nodeMap[centro],
                        target: nodeMap[ramo],
                        value: Math.max(valor, 0.1),
                        color: ramoColors[ramo] ? ramoColors[ramo] + '50' : 'rgba(189, 195, 199, 0.3)',
                        ramo: ramo
                    });
                });
            });

            // Crear links Ramo ‚Üí Mercado
            Object.entries(mercadoRamoData).forEach(([ramo, mercados]) => {
                Object.entries(mercados).forEach(([mercado, porcentaje]) => {
                    if (porcentaje > 0) {
                        const participacionRamo = ramoParticipacion[ramo] || 1;
                        const totalProduccion = 148;
                        const valor = (totalProduccion * participacionRamo / 100) * (porcentaje / 100);
                        links.push({
                            source: nodeMap[ramo],
                            target: nodeMap[mercado],
                            value: Math.max(valor, 0.1),
                            color: ramoColors[ramo] ? ramoColors[ramo] + '50' : 'rgba(189, 195, 199, 0.3)',
                            ramo: ramo
                        });
                    }
                });
            });

            const data = [{
                type: "sankey",
                orientation: "h",
                node: {
                    pad: 15,
                    thickness: 20,
                    line: {color: "black", width: 0.5},
                    label: nodes.map(n => n.name),
                    color: nodes.map(n => n.color),
                    customdata: nodes.map(n => n.name),
                    hovertemplate: '<b>%{customdata}</b><br>Producci√≥n: Q.%{value:.2f}M<extra></extra>'
                },
                link: {
                    source: links.map(l => l.source),
                    target: links.map(l => l.target),
                    value: links.map(l => l.value),
                    color: links.map(l => l.color),
                    customdata: links.map(l => l.ramo || 'Flujo'),
                    hovertemplate: '<b>%{customdata}</b><br>Flujo: Q.%{value:.2f}M<extra></extra>'
                }
            }];

            const layout = {
                title: "",
                font: {size: 11, family: 'Segoe UI'},
                height: 850,
                margin: {l: 10, r: 10, t: 20, b: 20}
            };

            Plotly.newPlot('sankeyCompleto', data, layout, {responsive: true});
        }

        // Crear visualizaci√≥n al cargar
        window.onload = function() {
            createSankeyCompleto();
        };
    </script>
</body>
</html>
